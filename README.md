# ssdr-infobroker

[![Build Status](https://travis-ci.org/sconklin/ssdr-infobroker.svg?branch=master)](https://travis-ci.org/sconklin/sdr-infobroker)
[![Go Report Card](https://goreportcard.com/badge/github.com/sconklin/ssdr-infobroker)](https://goreportcard.com/report/github.com/sconklin/ssdr-infobroker)
[![GoDoc](https://godoc.org/github.com/sconklin/ssdr-infobroker?status.svg)](https://godoc.org/github.com/sconklin/ssdr-infobroker)
[![MIT License](http://img.shields.io/badge/License-GPLv3-blue.svg)](./LICENSE)


This is intended to be an experimental gateway between the Flex Radio API and an MQTT broker to publish information about what's happening in the radio.

Sending commands to the radio is not yet implemented

## Configuration
There are a number of configuration files:

ibconfig.json is read on startup. There's a template file to edit for your installation.

```
{
"Radio": {
        "radio_sub_list_file": "radiosubs.conf",                 # File containing radio 'topics' to subscribe to
        "include_messages": "true"                               # True to include passing radio messages to MQTT
         },
"Mqtt": {
        "pub_topic_prefix" : "AI4QR/Home/Ham/Radio/Flex",        # All topics published to MQTT will be prefixed with this
        "topic_read":   "AI4QR/Home/Ham/Radio/Flex/Command",     # This topic is subscribed and all received text send to the radio as commands
        "broker":       "something.cloudmqtt.com",               # URL or address for your MQTT broker
        "broker_user": "auserstring",                            # username string for your MQTT broker
        "broker_pass": "auserpassword",                          # password string for your MQTT broker
        "broker_port": "17592",                                  # Port to use for your MQTT broker
        "broker_cert": "/etc/ssl/certs/ca-certificates.crt",     # Path to the TLS cert for the broker
        "only_publish_on_change": "true",                        # Not used/implemented
        "freq_error_change": "1.0E-12",                          # change threshold for reporting frequency error
        "topic_pub_list_file": "topics.conf",                    # A file containing the topic publishing list,  which will be published to MQTT
        "topic_dump_file": "topics.list"                         # A file to which to dump all topics generated from radio data, whether they are sent to the MQTT broker or not
        }
}
```

### Topic publishing list file
This file contains the topic publishing list, one topic per line. Lines beginning with '#' are ignored.

The radio generates a LOT of data, and you will probably only be interested in a subset of it. Use the radiosubs file to control which radio subsystems send data to this app, then further reduce the topics sent to the MQTT broker by explicitly enabling them in the topic publishing list file

Data from the radio is automatically parsed into multiple MQTT topics and then if enabled, published to the broker.

The application keeps track of all autogenerated topics. Any time a new one is detected that isn't enabled in the topic publishing list file, it is added, and the list of files are dumped to the topic dump file, and also to the same file name with a "'values" suffix, so you can look at what that topic would sent to MQTT if enabled.

The format of the topic dump file and the topic publishing file are identical, and anything not enabled for publishing in your configuration will be commented out. That means that you can copy the dump file over your config file and edit, to add new topics.

## General Information

This project is forked and substantially modified from [smartsdr-golang](https://github.com/baobrien/smartsdr-golang)

[Information about the Flex API](http://wiki.flexradio.com/index.php?title=SmartSDR_TCP/IP_API)

By default, UDP is blocked by the Ubuntu Firewall, open the ports like this:
sudo ufw allow from 172.31.0.0/8 to any port 4992 proto udp

## TODO (from original project)
[x] - discovery client

[x] - wfm->radio command interface (traffic_cop)

[x] - radio->wfm command interface

[ ] - VITA49 stream rx'er and tx'er (hal_*)

[ ] - actual sample processing pipeline
